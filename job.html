import pygame

# Initialize Pygame
pygame.init()

# Screen and grid settings
screen_width, screen_height = 800, 600
cell_size = 40
grid_width, grid_height = screen_width // cell_size, screen_height // cell_size

# Colors
WHITE = (255, 255, 255)
BLACK = (0, 0, 0)
GRAY = (169, 169, 169)
BLUE = (0, 0, 255)
RED = (255, 0, 0)

# Tools and grid setup
tools = ["Gate", "Conductor"]
current_tool = "Gate"
grid = [[{"gate": None, "conductor": False} for _ in range(grid_width)] for _ in range(grid_height)]

# Pygame setup
screen = pygame.display.set_mode((screen_width, screen_height))
pygame.display.set_caption("Wire and Gate System")
clock = pygame.time.Clock()


def draw_grid():
    """Draw the grid and its contents."""
    screen.fill(WHITE)
    
    for y in range(grid_height):
        for x in range(grid_width):
            cell = grid[y][x]
            
            # Draw conductors (as thin wires)
            if cell["conductor"]:
                pygame.draw.line(
                    screen,
                    GRAY,
                    (x * cell_size + cell_size // 2, y * cell_size),
                    (x * cell_size + cell_size // 2, (y + 1) * cell_size),
                    3
                )
                pygame.draw.line(
                    screen,
                    GRAY,
                    (x * cell_size, y * cell_size + cell_size // 2),
                    ((x + 1) * cell_size, y * cell_size + cell_size // 2),
                    3
                )
            
            # Draw gates (as blue rectangles)
            if cell["gate"]:
                pygame.draw.rect(
                    screen,
                    BLUE,
                    (x * cell_size + 5, y * cell_size + 5, cell_size - 10, cell_size - 10)
                )
            
            # Draw grid lines
            pygame.draw.rect(screen, BLACK, (x * cell_size, y * cell_size, cell_size, cell_size), 1)


def place_gate(x, y):
    """Place a gate at the specified grid position."""
    if not grid[y][x]["gate"]:  # Only place if there's no gate
        grid[y][x]["gate"] = True  # Add a gate
        grid[y][x]["conductor"] = False  # Remove conductor if overlapping


def place_conductor(x, y):
    """Place a conductor at the specified grid position."""
    grid[y][x]["conductor"] = True  # Add a conductor
    # Gates and wires can coexist


def handle_mouse_input():
    """Handle mouse input for placing gates or wires."""
    global current_tool
    mouse_x, mouse_y = pygame.mouse.get_pos()
    grid_x, grid_y = mouse_x // cell_size, mouse_y // cell_size
    
    if pygame.mouse.get_pressed()[0]:  # Left mouse button
        if current_tool == "Gate":
            place_gate(grid_x, grid_y)
        elif current_tool == "Conductor":
            place_conductor(grid_x, grid_y)


def main():
    global current_tool
    running = True
    
    while running:
        for event in pygame.event.get():
            if event.type == pygame.QUIT:
                running = False
            elif event.type == pygame.KEYDOWN:
                if event.key == pygame.K_g:
                    current_tool = "Gate"
                elif event.key == pygame.K_c:
                    current_tool = "Conductor"
        
        handle_mouse_input()
        draw_grid()
        pygame.display.flip()
        clock.tick(60)
    
    pygame.quit()


if __name__ == "__main__":
    main()
